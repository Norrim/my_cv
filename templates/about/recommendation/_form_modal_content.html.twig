{% extends 'partials/_form_modal_base.html.twig' %}

{% set form_id = 'recommendation-edit-all-form' %}

{% block form_body %}
    <div class="col-12">
        <div id="recommendations-collection"
             data-prototype="{{ include('about/recommendation/_recommendation_entry.html.twig', { 'recommendationForm': form.recommendations.vars.prototype })|e('html_attr') }}"
             data-index="{{ form.recommendations|length }}">

            {% for recommendationForm in form.recommendations %}
                {{ include('about/recommendation/_recommendation_entry.html.twig', { 'recommendationForm': recommendationForm }) }}
            {% endfor %}
        </div>

        <button type="button" class="btn btn-sm btn-primary mt-3" id="add-recommendation">
            <i class="feathericon-plus"></i> {{ 'recommendation.form.add'|trans }}
        </button>
    </div>

    <script>
        (function() {
            const container = document.getElementById('crudModalContent');
            if (!container) return;

            container.addEventListener('click', function(e) {
                const addButton = e.target.closest('#add-recommendation');
                if (addButton) {
                    const collectionHolder = document.getElementById('recommendations-collection');
                    if (!collectionHolder) return;

                    const prototype = collectionHolder.dataset.prototype;
                    const index = parseInt(collectionHolder.dataset.index);

                    const newForm = prototype.replace(/__name__/g, index);
                    collectionHolder.dataset.index = index + 1;

                    const wrapper = document.createElement('div');
                    wrapper.innerHTML = newForm;
                    const newEntry = wrapper.firstElementChild;

                    collectionHolder.appendChild(newEntry);
                }

                const removeBtn = e.target.closest('.js-remove-recommendation');
                if (removeBtn) {
                    const entry = removeBtn.closest('.recommendation-entry');
                    if (entry) {
                        entry.remove();
                    }
                }
            });
        })();
    </script>
{% endblock %}
