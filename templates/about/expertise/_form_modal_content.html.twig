{% extends 'partials/_form_modal_base.html.twig' %}

{% set form_id = 'expertise-edit-all-form' %}

{% block form_body %}
    <div class="col-12">
        <div id="expertises-collection"
             data-prototype="{{ include('about/expertise/_expertise_entry.html.twig', { 'expertiseForm': form.expertises.vars.prototype })|e('html_attr') }}"
             data-index="{{ form.expertises|length }}">

            {% for expertiseForm in form.expertises %}
                {{ include('about/expertise/_expertise_entry.html.twig', { 'expertiseForm': expertiseForm }) }}
            {% endfor %}
        </div>

        <button type="button" class="btn btn-sm btn-primary mt-3" id="add-expertise">
            <i class="feathericon-plus"></i> {{ 'expertise.form.add'|trans }}
        </button>
    </div>

    <script>
        (function() {
            const container = document.getElementById('crudModalContent');
            if (!container) return;

            container.addEventListener('click', function(e) {
                const addButton = e.target.closest('#add-expertise');
                if (addButton) {
                    const collectionHolder = document.getElementById('expertises-collection');
                    if (!collectionHolder) return;

                    const prototype = collectionHolder.dataset.prototype;
                    const index = parseInt(collectionHolder.dataset.index);

                    const newForm = prototype.replace(/__name__/g, index);
                    collectionHolder.dataset.index = index + 1;

                    const wrapper = document.createElement('div');
                    wrapper.innerHTML = newForm;
                    const newEntry = wrapper.firstElementChild;

                    collectionHolder.appendChild(newEntry);
                }

                const removeBtn = e.target.closest('.js-remove-expertise');
                if (removeBtn) {
                    const entry = removeBtn.closest('.expertise-entry');
                    if (entry) {
                        entry.remove();
                    }
                }
            });
        })();
    </script>
{% endblock %}
