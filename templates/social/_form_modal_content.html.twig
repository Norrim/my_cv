{% extends 'partials/_form_modal_base.html.twig' %}

{% set form_id = 'social-edit-all-form' %}

{% block form_body %}
    <div class="col-12">
        <div id="socials-collection"
             data-prototype="{{ include('social/_social_entry.html.twig', { 'socialForm': form.socials.vars.prototype })|e('html_attr') }}"
             data-index="{{ form.socials|length }}">

            {% for socialForm in form.socials %}
                {{ include('social/_social_entry.html.twig', { 'socialForm': socialForm }) }}
            {% endfor %}
        </div>

        <button type="button" class="btn btn-sm btn-primary mt-3" id="add-social">
            <i class="feathericon-plus"></i> {{ 'social.form.add'|trans }}
        </button>
    </div>

    <script>
        (function() {
            const container = document.getElementById('crudModalContent');
            if (!container) return;

            // Utilisation de la délégation d'événements pour l'ajout
            container.addEventListener('click', function(e) {
                const addButton = e.target.closest('#add-social');
                if (addButton) {
                    const collectionHolder = document.getElementById('socials-collection');
                    if (!collectionHolder) return;

                    const prototype = collectionHolder.dataset.prototype;
                    const index = parseInt(collectionHolder.dataset.index);

                    const newForm = prototype.replace(/__name__/g, index);
                    collectionHolder.dataset.index = index + 1;

                    const wrapper = document.createElement('div');
                    wrapper.innerHTML = newForm;
                    const newEntry = wrapper.firstElementChild;

                    collectionHolder.appendChild(newEntry);
                }

                // Utilisation de la délégation d'événements pour la suppression
                const removeBtn = e.target.closest('.js-remove-social');
                if (removeBtn) {
                    const entry = removeBtn.closest('.social-entry');
                    if (entry) {
                        entry.remove();
                    }
                }
            });
        })();
    </script>
{% endblock %}
